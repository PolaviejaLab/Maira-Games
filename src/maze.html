<!DOCTYPE html>
<html>
	<head>
		<title>Maze game</title>

		<meta charset="utf8" />

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

		<script src="levels/maze/level1.js"></script>
		<script src="levels/maze/level2.js"></script>
		<script src="levels/maze/level3.js"></script>

		<script src="js/vendor/jquery-2.1.3.min.js"></script>
		<script src="js/build/maze.js"></script>

		<style>
			body {
				margin: 0px;
				padding: 0px;
			}

			#button {
				padding: 10px;
			}

			#game-canvas {
				border: 1px solid gray;
				display: none;
			}

			#player-error {
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<div class="panel panel-primary" id="player-error">
				<div class="panel-heading">
					Player not defined
				</div>
				<div class="panel-body">
					The game cannot be started because the player has not been set.
					You can start as
					<a href="?player=1">Player 1</a>,
					<a href="?player=2">Player 2</a>, or perhaps as
					<a href="?player=3">Player 3</a>.
				</div>
			</div>
		</div>

		<div id="button">
			<button id="enter-exit-fs" class="btn btn-primary" onclick="enterFullscreen()">Toggle fullscreen</button>
		</div>

		<div id="fullscreen">
			<canvas id="game-canvas"></canvas>
		</div>

		<script>
			var canvas_id = "game-canvas";

			// Global variables
			var widthwall = 2;
			var widthspace = 44;
			var datasink = "http://www.ivarclemens.nl/maze_game/sink.php";

			var gameStart = false;
			var playerId = false;

			(function() {
				gameStart = getQueryField("game");
				playerId = getQueryField("player");

				if(!playerId) {
					$("#player-error").show();
					return;
				}

				// If the game has not been assigned an identifier yet, do so now
				if(!gameStart) {
					gameStart = Math.floor(Date.now() / 1000);
					window.location.href = getAddress() + "?game=" + gameStart + "&player=" + playerId;
					return;
				}

				// Everything is fine, start the game
				$("#game-canvas").show();

				var engine = new Engine();
				var game = new Game();

				engine.initializeEngine(canvas_id,
					(widthspace + widthwall) * 27 + widthwall,
					(widthspace + widthwall) * 16 + widthwall, game);

				var level = new Level();
				game.addObject("level", level);
				game.addObject("player", new Player());
				game.addObject("controls", new Controls());
			}());
		</script>
	</body>
</html>
