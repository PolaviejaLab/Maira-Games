<!DOCTYPE html>
<html>
	<head>
		<title>Platform game</title>

		<meta charset="utf8" />

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

		<script src="js/vendor/jquery-2.1.3.min.js"></script>
		<script src="js/common/compat.js"></script>
		<script src="js/common/input.js"></script>
		<script src="js/common/url.js"></script>

		<script src="js/game.js"></script>
		<script src="js/player.js"></script>
		<script src="js/level.js"></script>

		<script>
			function getAddress()
			{
				var url = window.location.href;
				var parts = url.split(/[\?]+/);

				return parts[0];
			}

			function querySt(Key) {
		    	var url = window.location.href;
		    	KeysValues = url.split(/[\?&]+/);
		    	for (i = 0; i < KeysValues.length; i++) {
		    	    KeyValue = KeysValues[i].split("=");
			        if (KeyValue[0] == Key) {
			            return KeyValue[1];
			        }
		    	}

				return false;
			}
		</script>

		<style>
			#game-canvas {
				border: 1px solid gray;
				display: none;
			}

			#player-error {
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<div class="panel panel-primary" id="player-error">
				<div class="panel-heading">
					Player not defined
				</div>
				<div class="panel-body">
					The game cannot be started because the player has not been set.
				</div>
			</div>
		</div>


		<div class="container">
			<canvas id="game-canvas" class="center-block"></canvas>
		</div>


		<script>
			// Global variables
			var widthwall = 2;
			var widthspace = 32;
			var datasink = "http://www.ivarclemens.nl/maze_game/sink.php";

			var gameStart = false;
			var playerId = false;

			(function() {
				gameStart = querySt("game");
				playerId = querySt("player");

				if(!playerId) {
					$("#player-error").show();
					return;
				}

				// If the game has not been assigned an identifier yet, do so now
				if(!gameStart) {
					gameStart = Math.floor(Date.now() / 1000);
					window.location.href = getAddress() + "?game=" + gameStart + "&player=" + playerId;
					return;
				}

				// Everything is fine, start the game
				$("#game-canvas").show();

				var game = new Game("game-canvas", 32 * 24, 32 * 8);
				var level = new Level();
				game.addObject("level", level);
				game.addObject("player", new Player());
			}());
		</script>
	</body>
</html>
