<!DOCTYPE html>
<html>
	<head>
		<title>Platform game</title>
		
		<meta charset="utf8" />
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		
		<script src="js/vendor/jquery-2.1.3.min.js"></script>
		
		<script src="js/common/compat.js"></script>
		<script src="js/common/url.js"></script>
				
		<script src="math.js"></script>
		<script src="graphics.js"></script>
		<script src="game.js"></script>		
		<script src="input.js"></script>		
		<script src="player.js"></script>
		<script src="level.js"></script>		
		<script src="sprites.js"></script>
				
		<style>
			#game-canvas {
				border: 1px solid gray;
				width: 768px;
			}

			#game-canvas {
				display: none;
			}
			
			#level-error {
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<div class="panel panel-primary" id="loading-screen">
				<div class="panel-heading">
					Loading
				</div>
				<div class="panel-body">
					Pre-loading game content, please wait.
				</div>
			</div>

			<div class="panel panel-danger" id="level-error">
				<div class="panel-heading">
					Could not load level
				</div>
				<div class="panel-body">
					Unable to load the specified level
				</div>
			</div>
		</div>

		
		<div class="container">
			<canvas id="game-canvas" class="center-block"></canvas>
		</div>

		<script>
			var server = "http://www.ivarclemens.nl/platform_game/";
		
			(function() {
				/** 
				 * Width and height of canvas in blocks 
				 */
				var width = 35;
				var height = 13;
				
				/**
				 * Id of the canvas element to use
				 */
				var canvas_id = "game-canvas";


				/****************************************************/


				/**
				 * Set canvas dimensions
				 */
				$("#" + canvas_id).width((width * 32) + "px");

				/**
				 * Initialize game
				 */
				var game = new Game(canvas_id, 32 * width, 32 * height);
				game.spriteManager = new SpriteManager();

				/**
				 * Determine name of level to load
				 */
				var levelName = getQueryField("level");

				if(!levelName || levelName == "")
					levelName = "level1";

				/**
				 * Initialize level and player objects
				 */
				var level = new Level();
				level.loadLevel(levelName).then(function(response) {					
					game.addObject("level", level);
					game.addObject("player", new Player());

					$("#loading-screen").fadeOut(500, function() {
						$("#game-canvas").fadeIn(250);
					});
				}, function(error) {
					$("#loading-screen").fadeOut(500, function() {
						$("#level-error").fadeIn(250);
					});					
				});
			}());
		</script>

		<p class="text-center">
			<small>Using graphics by <a href="http://www.kenney.nl">Kenney</a> and creek23</small>
		</p>
	</body>
</html>